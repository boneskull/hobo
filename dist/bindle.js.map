{"version":3,"sources":["../src/bindle.js"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;wBAEO,UAAU;;;;yBACd,YAAY;;;;sBACT,QAAQ;;;;uBACP,SAAS;;;;kBACD,MAAM;;qBAChB,SAAS;;;;oBACV,MAAM;;;;AAEvB,IAAM,QAAQ,GAAG;AACf,IAAE,EAAE,SAAS;AACb,SAAO,EAAE,IAAI;AACb,OAAK,EAAE,IAAI;CACZ,CAAC;;AAEF,IAAM,MAAM,GAAG,0BAAQ;AACrB,UAAQ,EAAE;AACR,YAAQ,EAAE,QAAQ;GACnB;AACD,MAAI,EAAE,QAAQ;AACd,MAAI,EAAA,gBAAG;AACL,QAAM,IAAI,GAAG,IAAI,CAAC,IAAI,GAAG,sBAAQ,YAAY,CAAC,4BAAI,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;;AAEjE,WAAO,gBAAO,IAAI,CAAC,OAAO,CAAC,CACxB,IAAI,CAAC,IAAI,CAAC,CACV,IAAI,CAAC,YAAW;AACf,aAAO,eAAM,IAAI,CAAC,OAAO,CAAC,CAAC;KAC5B,CAAC,CACD,IAAI,CAAC,UAAS,MAAM,EAAE;AACrB,UAAI,CAAC,MAAM,EAAE;AACX,eAAO,0BAAY,UAAC,OAAO,EAAE,MAAM,EAAK;AACtC,8BAAO,MAAM,EAAE,CACZ,EAAE,CAAC,OAAO,EAAE,MAAM,CAAC,CACnB,GAAG,CAAC,YAAM;AACT,gBAAI,CAAC,SAAS,EAAE,CACb,IAAI,CAAC,OAAO,CAAC,CAAC;WAClB,CAAC,CAAC;SACN,CAAC,CAAC;OACJ;KACF,CAAC,CACD,IAAI,CAAC,YAAW;AACf,UAAI,CAAC,KAAK,GAAG,wBAAM;AACjB,UAAE,EAAE,QAAQ;AACZ,gBAAQ,EAAE,IAAI,CAAC,OAAO;OACvB,CAAC,CAAC;KACJ,CAAC,CAAC;GACN;CACF,CAAC,CAAC;;AAEH,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC","file":"bindle.js","sourcesContent":["'use strict';\n\nimport Promise from 'bluebird';\nimport git from 'simple-git';\nimport domain from 'domain';\nimport stampit from 'stampit';\nimport {mkdirp, isGit} from './fs';\nimport Store from './store';\nimport path from 'path';\n\nconst defaults = {\n  id: 'default',\n  dirpath: null,\n  store: null\n};\n\nconst Bindle = stampit({\n  'static': {\n    defaults: defaults\n  },\n  refs: defaults,\n  init() {\n    const _git = this._git = Promise.promisifyAll(git(this.dirpath));\n\n    return mkdirp(this.dirpath)\n      .bind(this)\n      .then(function() {\n        return isGit(this.dirpath);\n      })\n      .then(function(result) {\n        if (!result) {\n          return new Promise((resolve, reject) => {\n            domain.create()\n              .on('error', reject)\n              .run(() => {\n                _git.initAsync()\n                  .then(resolve);\n              });\n          });\n        }\n      })\n      .then(function() {\n        this.store = Store({\n          id: 'bindle',\n          rootPath: this.dirpath\n        });\n      });\n  }\n});\n\nmodule.exports = Bindle;\n"]}